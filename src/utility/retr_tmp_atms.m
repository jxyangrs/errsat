function [pres,tmp] = retr_tmp_atms(tb,theta)
% atms temperature retrieval
% 
% Input:
%       tb,         tb of channel 5-12 of atms,         [tb,channel]
%       theta,      local zenith angle (degree),        [theta,channel]/[theta,1]
% 
% Output:
%       tmp,        temperature at pressure level,      [tmp,channel,pressure-level(23)]
%       pres,       pressure level (mb),                [50;70;100;125;150;175;200;225;250;275;300;350;400;450;500;550;600;650;700;750;800;850;1000]
% 
% Description:
%           T(p) = C0(p) + sum_i_n(Ci(p)*Tb(i)) + Csz(p)/cos(theta)
%       where where p is the pressure level, theta is the satellite local zenith angle, i is the channel, and Tb is the atms brightness temperature.
%       reference:
%       Zhu & Weng, Hurricane Sandy warm-core structure observed from advanced Technology Microwave Sounder, GRL 2013
% 
% written by John Xun Yang, University of Maryland, jxyang@umd.edu, or johnxun@umich.edu, 8/6/2020


% Level(mb)     C0  C5-12   Csz
M = [50 -19.380 -0.010 -0.173 0.071 0.592 -0.325 0.061 1.115 -0.240 -0.259
70 21.016 0.197 -0.634 0.209 0.493 -0.371 0.852 0.495 -0.274 -7.434
100 52.627 -0.069 0.508 -0.578 -0.870 0.641 2.034 -0.690 -0.140 -12.392
125 92.005 -0.074 0.664 -0.975 -1.070 1.610 1.249 -0.706 -0.050 -10.029
150 112.761 0.168 0.229 -1.015 -0.848 2.173 0.320 -0.611 0.137 -9.430
175 106.053 0.460 -0.384 -0.878 -0.248 2.197 -0.520 -0.307 0.257 -7.987
200 105.279 0.681 -1.076 -0.516 0.720 1.474 -1.155 0.196 0.242 -5.098
225 118.178 0.657 -1.415 0.007 1.420 0.494 -1.473 0.668 0.109 1.775
250 105.111 0.520 -1.350 0.534 1.644 -0.373 -1.350 0.848 -0.008 10.234
275 60.489 0.368 -1.012 0.983 1.393 -0.882 -0.962 0.756 -0.041 17.970
300 19.265 0.248 -0.649 1.296 0.987 -1.116 -0.577 0.562 -0.010 23.244
350 -34.306 0.109 -0.108 1.573 0.353 -1.199 -0.076 0.265 0.023 29.276
400 -62.373 -0.026 0.433 1.555 -0.197 -1.042 0.221 0.062 0.047 32.267
450 -65.056 -0.201 0.966 1.398 -0.692 -0.763 0.380 -0.119 0.097 34.310
500 -60.065 -0.409 1.470 1.207 -1.081 -0.486 0.462 -0.245 0.126 36.971
550 -46.377 -0.588 1.872 1.009 -1.326 -0.290 0.492 -0.295 0.116 38.936
600 -29.615 -0.651 2.063 0.831 -1.405 -0.176 0.484 -0.307 0.095 38.910
650 -14.066 -0.621 2.124 0.649 -1.410 -0.063 0.436 -0.310 0.084 37.242
700 -10.486 -0.541 2.146 0.440 -1.344 0.051 0.357 -0.256 0.043 35.241
750 -19.197 -0.440 2.131 0.247 -1.205 0.129 0.262 -0.153 -0.013 33.533
800 -39.417 -0.293 2.001 0.113 -0.942 0.123 0.157 -0.031 -0.058 31.782
850 -74.453 -0.015 1.736 -0.036 -0.611 0.141 0.064 0.078 -0.105 28.477
1000 23.847 1.189 -0.279 -0.147 0.545 -0.001 -0.430 0.248 -0.092 1.447
];

pres = M(:,1);
C0(1,:) = M(:,2);
C5_12(1,:,:) = M(:,3:10);
Csz(1,:) = M(:,11);

[n1,n2] = size(tb);
tb = reshape(tb,[n1,1,n2]);

tmp = C0 + sum(C5_12.*tb,3) + Csz./cosd(theta);

